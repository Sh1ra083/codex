> ## Documentation Index
> Fetch the complete documentation index at: https://code.claude.com/docs/llms.txt
> Use this file to discover all available pages before exploring further.

# Координируйте команды сеансов Claude Code

> Координируйте несколько экземпляров Claude Code, работающих вместе как команда, с общими задачами, обменом сообщениями между агентами и централизованным управлением.

<Warning>
  Команды агентов являются экспериментальными и отключены по умолчанию. Включите их, добавив `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS` в ваш [settings.json](/ru/settings) или переменную окружения. Команды агентов имеют [известные ограничения](#limitations) в отношении возобновления сеанса, координации задач и поведения при завершении.
</Warning>

Команды агентов позволяют координировать несколько экземпляров Claude Code, работающих вместе. Один сеанс выступает в роли лидера команды, координируя работу, назначая задачи и синтезируя результаты. Товарищи по команде работают независимо, каждый в своем контекстном окне, и общаются друг с другом напрямую.

В отличие от [subagents](/ru/sub-agents), которые работают в одном сеансе и могут только докладывать основному агенту, вы также можете взаимодействовать с отдельными товарищами по команде напрямую, не проходя через лидера.

На этой странице рассматривается:

* [Когда использовать команды агентов](#when-to-use-agent-teams), включая лучшие варианты использования и сравнение с subagents
* [Запуск команды](#start-your-first-agent-team)
* [Управление товарищами по команде](#control-your-agent-team), включая режимы отображения, назначение задач и делегирование
* [Лучшие практики для параллельной работы](#best-practices)

## Когда использовать команды агентов

Команды агентов наиболее эффективны для задач, где параллельное исследование добавляет реальную ценность. Полные сценарии см. в [примерах вариантов использования](#use-case-examples). Самые сильные варианты использования:

* **Исследование и проверка**: несколько товарищей по команде могут одновременно исследовать различные аспекты проблемы, а затем делиться и оспаривать выводы друг друга
* **Новые модули или функции**: товарищи по команде могут владеть отдельными частями, не мешая друг другу
* **Отладка с конкурирующими гипотезами**: товарищи по команде одновременно тестируют различные теории и быстрее сходятся на ответе
* **Координация между слоями**: изменения, охватывающие фронтенд, бэкенд и тесты, каждый из которых принадлежит другому товарищу по команде

Команды агентов добавляют накладные расходы на координацию и используют значительно больше токенов, чем один сеанс. Они работают лучше всего, когда товарищи по команде могут работать независимо. Для последовательных задач, редактирования одного файла или работы со множеством зависимостей более эффективны один сеанс или [subagents](/ru/sub-agents).

### Сравнение с subagents

Как команды агентов, так и [subagents](/ru/sub-agents) позволяют распараллелить работу, но они работают по-разному. Выбирайте в зависимости от того, нужны ли вашим работникам общаться друг с другом:

|                       | Subagents                                                         | Команды агентов                                              |
| :-------------------- | :---------------------------------------------------------------- | :----------------------------------------------------------- |
| **Контекст**          | Собственное контекстное окно; результаты возвращаются вызывающему | Собственное контекстное окно; полностью независимы           |
| **Коммуникация**      | Докладывают результаты только основному агенту                    | Товарищи по команде обмениваются сообщениями напрямую        |
| **Координация**       | Основной агент управляет всей работой                             | Общий список задач с самокоординацией                        |
| **Лучше всего для**   | Сосредоточенные задачи, где имеет значение только результат       | Сложная работа, требующая обсуждения и сотрудничества        |
| **Стоимость токенов** | Ниже: результаты суммируются обратно в основной контекст          | Выше: каждый товарищ по команде — отдельный экземпляр Claude |

Используйте subagents, когда вам нужны быстрые, сосредоточенные работники, которые докладывают обратно. Используйте команды агентов, когда товарищи по команде должны делиться выводами, оспаривать друг друга и координировать самостоятельно.

## Включение команд агентов

Команды агентов отключены по умолчанию. Включите их, установив переменную окружения `CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS` на `1`, либо в окружении вашей оболочки, либо через [settings.json](/ru/settings):

```json settings.json theme={null}
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  }
}
```

## Запуск вашей первой команды агентов

После включения команд агентов попросите Claude создать команду агентов и опишите задачу и структуру команды, которую вы хотите, на естественном языке. Claude создает команду, порождает товарищей по команде и координирует работу на основе вашего запроса.

Этот пример хорошо работает, потому что три роли независимы и могут исследовать проблему, не ожидая друг друга:

```
I'm designing a CLI tool that helps developers track TODO comments across
their codebase. Create an agent team to explore this from different angles: one
teammate on UX, one on technical architecture, one playing devil's advocate.
```

После этого Claude создает команду с [общим списком задач](/ru/interactive-mode#task-list), порождает товарищей по команде для каждой перспективы, заставляет их исследовать проблему, синтезирует выводы и пытается [очистить команду](#clean-up-the-team) по завершении.

Терминал лидера перечисляет всех товарищей по команде и то, над чем они работают. Используйте Shift+Up/Down для выбора товарища по команде и отправки ему сообщения напрямую.

Если вы хотите, чтобы каждый товарищ по команде находился в своей отдельной панели, см. [Выбор режима отображения](#choose-a-display-mode).

## Управление вашей командой агентов

Скажите лидеру, что вы хотите, на естественном языке. Он обрабатывает координацию команды, назначение задач и делегирование на основе ваших инструкций.

### Выбор режима отображения

Команды агентов поддерживают два режима отображения:

* **In-process**: все товарищи по команде работают внутри вашего основного терминала. Используйте Shift+Up/Down для выбора товарища по команде и введите сообщение для отправки ему напрямую. Работает в любом терминале, дополнительная настройка не требуется.
* **Split panes**: каждый товарищ по команде получает свою панель. Вы можете видеть вывод всех одновременно и щелкнуть в панель для прямого взаимодействия. Требует tmux или iTerm2.

<Note>
  `tmux` имеет известные ограничения на некоторых операционных системах и традиционно работает лучше всего на macOS. Использование `tmux -CC` в iTerm2 — это рекомендуемая точка входа в `tmux`.
</Note>

По умолчанию используется `"auto"`, который использует разделенные панели, если вы уже работаете внутри сеанса tmux, и in-process в противном случае. Параметр `"tmux"` включает режим разделенных панелей и автоматически определяет, использовать ли tmux или iTerm2 на основе вашего терминала. Чтобы переопределить, установите `teammateMode` в вашем [settings.json](/ru/settings):

```json  theme={null}
{
  "teammateMode": "in-process"
}
```

Чтобы принудительно включить режим in-process для одного сеанса, передайте его как флаг:

```bash  theme={null}
claude --teammate-mode in-process
```

Режим разделенных панелей требует либо [tmux](https://github.com/tmux/tmux/wiki), либо iTerm2 с [`it2` CLI](https://github.com/mkusaka/it2). Для установки вручную:

* **tmux**: установите через менеджер пакетов вашей системы. Инструкции для конкретной платформы см. в [вики tmux](https://github.com/tmux/tmux/wiki/Installing).
* **iTerm2**: установите [`it2` CLI](https://github.com/mkusaka/it2), затем включите Python API в **iTerm2 → Settings → General → Magic → Enable Python API**.

### Указание товарищей по команде и моделей

Claude решает количество товарищей по команде для порождения на основе вашей задачи, или вы можете указать ровно то, что вы хотите:

```
Create a team with 4 teammates to refactor these modules in parallel.
Use Sonnet for each teammate.
```

### Требование одобрения плана для товарищей по команде

Для сложных или рискованных задач вы можете потребовать, чтобы товарищи по команде планировали перед реализацией. Товарищ по команде работает в режиме плана только для чтения до тех пор, пока лидер не одобрит его подход:

```
Spawn an architect teammate to refactor the authentication module.
Require plan approval before they make any changes.
```

Когда товарищ по команде завершает планирование, он отправляет запрос на одобрение плана лидеру. Лидер проверяет план и либо одобряет его, либо отклоняет с обратной связью. Если отклонено, товарищ по команде остается в режиме плана, пересматривает на основе обратной связи и повторно отправляет. После одобрения товарищ по команде выходит из режима плана и начинает реализацию.

Лидер принимает решения об одобрении автономно. Чтобы повлиять на суждение лидера, дайте ему критерии в вашем запросе, такие как «одобрять только планы, которые включают покрытие тестами» или «отклонять планы, которые изменяют схему базы данных».

### Использование режима делегирования

Без режима делегирования лидер иногда начинает реализовывать задачи сам вместо того, чтобы ждать товарищей по команде. Режим делегирования предотвращает это, ограничивая лидера инструментами только для координации: порождение, обмен сообщениями, завершение товарищей по команде и управление задачами.

Это полезно, когда вы хотите, чтобы лидер сосредоточился исключительно на оркестровке, такой как разбиение работы, назначение задач и синтез результатов, без прямого касания кода.

Чтобы включить его, сначала запустите команду, затем нажмите Shift+Tab для переключения в режим делегирования.

### Общение с товарищами по команде напрямую

Каждый товарищ по команде — это полный, независимый сеанс Claude Code. Вы можете отправить сообщение любому товарищу по команде напрямую, чтобы дать дополнительные инструкции, задать дополнительные вопросы или переориентировать его подход.

* **Режим in-process**: используйте Shift+Up/Down для выбора товарища по команде, затем введите сообщение для отправки ему. Нажмите Enter для просмотра сеанса товарища по команде, затем Escape для прерывания его текущего хода. Нажмите Ctrl+T для переключения списка задач.
* **Режим split-pane**: щелкните в панель товарища по команде для прямого взаимодействия с его сеансом. Каждый товарищ по команде имеет полный вид своего собственного терминала.

### Назначение и принятие задач

Общий список задач координирует работу по всей команде. Лидер создает задачи, а товарищи по команде работают над ними. Задачи имеют три состояния: ожидание, в процессе и завершено. Задачи также могут зависеть от других задач: ожидающая задача с неразрешенными зависимостями не может быть принята до завершения этих зависимостей.

Лидер может явно назначать задачи или товарищи по команде могут самостоятельно принимать:

* **Лидер назначает**: скажите лидеру, какую задачу дать какому товарищу по команде
* **Самостоятельное принятие**: после завершения задачи товарищ по команде самостоятельно выбирает следующую неназначенную, разблокированную задачу

Принятие задач использует блокировку файлов для предотвращения условий гонки, когда несколько товарищей по команде пытаются принять одну и ту же задачу одновременно.

### Завершение товарищей по команде

Чтобы корректно завершить сеанс товарища по команде:

```
Ask the researcher teammate to shut down
```

Лидер отправляет запрос на завершение. Товарищ по команде может одобрить, выходя корректно, или отклонить с объяснением.

### Очистка команды

Когда вы закончите, попросите лидера очистить:

```
Clean up the team
```

Это удаляет общие ресурсы команды. Когда лидер запускает очистку, он проверяет наличие активных товарищей по команде и завершается с ошибкой, если какие-либо все еще работают, поэтому сначала завершите их.

<Warning>
  Всегда используйте лидера для очистки. Товарищи по команде не должны запускать очистку, потому что их контекст команды может не разрешиться правильно, потенциально оставляя ресурсы в несогласованном состоянии.
</Warning>

## Как работают команды агентов

Этот раздел охватывает архитектуру и механику команд агентов. Если вы хотите начать их использовать, см. [Управление вашей командой агентов](#control-your-agent-team) выше.

### Как Claude запускает команды агентов

Есть два способа запуска команд агентов:

* **Вы запрашиваете команду**: дайте Claude задачу, которая выигрывает от параллельной работы, и явно попросите команду агентов. Claude создает одну на основе ваших инструкций.
* **Claude предлагает команду**: если Claude определит, что ваша задача выигрывает от параллельной работы, он может предложить создать команду. Вы подтверждаете перед тем, как он продолжит.

В обоих случаях вы остаетесь в контроле. Claude не создаст команду без вашего одобрения.

### Архитектура

Команда агентов состоит из:

| Компонент               | Роль                                                                                                      |
| :---------------------- | :-------------------------------------------------------------------------------------------------------- |
| **Лидер команды**       | Основной сеанс Claude Code, который создает команду, порождает товарищей по команде и координирует работу |
| **Товарищи по команде** | Отдельные экземпляры Claude Code, которые каждый работают над назначенными задачами                       |
| **Список задач**        | Общий список рабочих элементов, которые товарищи по команде принимают и завершают                         |
| **Почтовый ящик**       | Система обмена сообщениями для коммуникации между агентами                                                |

Параметры конфигурации отображения см. в [Выбор режима отображения](#choose-a-display-mode). Сообщения товарищей по команде поступают лидеру автоматически.

Система автоматически управляет зависимостями задач. Когда товарищ по команде завершает задачу, от которой зависят другие задачи, заблокированные задачи разблокируются без ручного вмешательства.

Команды и задачи хранятся локально:

* **Конфигурация команды**: `~/.claude/teams/{team-name}/config.json`
* **Список задач**: `~/.claude/tasks/{team-name}/`

Конфигурация команды содержит массив `members` с именем каждого товарища по команде, ID агента и типом агента. Товарищи по команде могут читать этот файл для обнаружения других членов команды.

### Разрешения

Товарищи по команде начинают с параметров разрешений лидера. Если лидер работает с `--dangerously-skip-permissions`, все товарищи по команде тоже. После порождения вы можете изменить режимы отдельных товарищей по команде, но вы не можете установить режимы для отдельных товарищей по команде во время порождения.

### Контекст и коммуникация

Каждый товарищ по команде имеет свое собственное контекстное окно. При порождении товарищ по команде загружает тот же контекст проекта, что и обычный сеанс: CLAUDE.md, MCP servers и skills. Он также получает запрос на порождение от лидера. История разговора лидера не переносится.

**Как товарищи по команде делятся информацией:**

* **Автоматическая доставка сообщений**: когда товарищи по команде отправляют сообщения, они автоматически доставляются получателям. Лидеру не нужно опрашивать обновления.
* **Уведомления о простое**: когда товарищ по команде завершает и останавливается, он автоматически уведомляет лидера.
* **Общий список задач**: все агенты могут видеть статус задачи и принимать доступную работу.

**Обмен сообщениями товарищей по команде:**

* **message**: отправить сообщение одному конкретному товарищу по команде
* **broadcast**: отправить всем товарищам по команде одновременно. Используйте редко, так как затраты масштабируются с размером команды.

### Использование токенов

Команды агентов используют значительно больше токенов, чем один сеанс. Каждый товарищ по команде имеет свое собственное контекстное окно, и использование токенов масштабируется с количеством активных товарищей по команде. Для исследования, проверки и работы над новыми функциями дополнительные токены обычно стоят того. Для рутинных задач один сеанс более экономичен. Руководство по использованию см. в [затратах на токены команды агентов](/ru/costs#agent-team-token-costs).

## Примеры вариантов использования

Эти примеры показывают, как команды агентов обрабатывают задачи, где параллельное исследование добавляет ценность.

### Запуск параллельной проверки кода

Один рецензент имеет тенденцию сосредоточиваться на одном типе проблемы за раз. Разделение критериев проверки на независимые области означает, что безопасность, производительность и покрытие тестами получают тщательное внимание одновременно. Запрос назначает каждому товарищу по команде отдельный фокус, чтобы они не перекрывались:

```
Create an agent team to review PR #142. Spawn three reviewers:
- One focused on security implications
- One checking performance impact
- One validating test coverage
Have them each review and report findings.
```

Каждый рецензент работает с одного и того же PR, но применяет другой фильтр. Лидер синтезирует выводы всех трех после их завершения.

### Исследование с конкурирующими гипотезами

Когда корневая причина неясна, один агент имеет тенденцию находить одно правдоподобное объяснение и останавливаться. Запрос борется с этим, делая товарищей по команде явно враждебными: работа каждого — не только исследовать свою теорию, но и оспаривать теории других.

```
Users report the app exits after one message instead of staying connected.
Spawn 5 agent teammates to investigate different hypotheses. Have them talk to
each other to try to disprove each other's theories, like a scientific
debate. Update the findings doc with whatever consensus emerges.
```

Структура дебатов — это ключевой механизм здесь. Последовательное исследование страдает от якорения: как только одна теория исследуется, последующее исследование смещено в сторону нее.

С несколькими независимыми следователями, активно пытающимися опровергнуть друг друга, теория, которая выживает, гораздо более вероятно, что это будет фактическая корневая причина.

## Лучшие практики

### Дайте товарищам по команде достаточно контекста

Товарищи по команде загружают контекст проекта автоматически, включая CLAUDE.md, MCP servers и skills, но они не наследуют историю разговора лидера. Подробности см. в [Контекст и коммуникация](#context-and-communication). Включите детали, специфичные для задачи, в запрос на порождение:

```
Spawn a security reviewer teammate with the prompt: "Review the authentication module
at src/auth/ for security vulnerabilities. Focus on token handling, session
management, and input validation. The app uses JWT tokens stored in
httpOnly cookies. Report any issues with severity ratings."
```

### Размер задач надлежащим образом

* **Слишком маленькие**: накладные расходы на координацию превышают выгоду
* **Слишком большие**: товарищи по команде работают слишком долго без проверок, увеличивая риск потраченной впустую работы
* **Правильный размер**: самостоятельные единицы, которые производят четкий результат, такие как функция, файл теста или проверка

<Tip>
  Лидер разбивает работу на задачи и назначает их товарищам по команде автоматически. Если он не создает достаточно задач, попросите его разделить работу на более мелкие части. Наличие 5-6 задач на товарища по команде держит всех продуктивными и позволяет лидеру переназначить работу, если кто-то застрял.
</Tip>

### Ждите завершения товарищей по команде

Иногда лидер начинает реализовывать задачи сам вместо того, чтобы ждать товарищей по команде. Если вы заметите это:

```
Wait for your teammates to complete their tasks before proceeding
```

### Начните с исследования и проверки

Если вы новичок в командах агентов, начните с задач, которые имеют четкие границы и не требуют написания кода: проверка PR, исследование библиотеки или исследование ошибки. Эти задачи показывают ценность параллельного исследования без проблем координации, которые приходят с параллельной реализацией.

### Избегайте конфликтов файлов

Два товарища по команде, редактирующие один и тот же файл, приводят к перезаписям. Разбейте работу так, чтобы каждый товарищ по команде владел другим набором файлов.

### Мониторинг и управление

Проверяйте прогресс товарищей по команде, переориентируйте подходы, которые не работают, и синтезируйте выводы по мере их поступления. Оставление команды без присмотра на слишком долгое время увеличивает риск потраченной впустую работы.

## Устранение неполадок

### Товарищи по команде не появляются

Если товарищи по команде не появляются после того, как вы попросили Claude создать команду:

* В режиме in-process товарищи по команде могут уже работать, но не видны. Нажмите Shift+Down для переключения между активными товарищами по команде.
* Проверьте, что задача, которую вы дали Claude, была достаточно сложной, чтобы оправдать команду. Claude решает, порождать ли товарищей по команде, на основе задачи.
* Если вы явно запросили разделенные панели, убедитесь, что tmux установлен и доступен в вашем PATH:
  ```bash  theme={null}
  which tmux
  ```
* Для iTerm2 проверьте, что `it2` CLI установлен и Python API включен в предпочтениях iTerm2.

### Слишком много запросов разрешений

Запросы разрешений товарищей по команде всплывают лидеру, что может создать трение. Предварительно одобрите общие операции в ваших [параметрах разрешений](/ru/permissions) перед порождением товарищей по команде, чтобы уменьшить прерывания.

### Товарищи по команде останавливаются при ошибках

Товарищи по команде могут остановиться после возникновения ошибок вместо восстановления. Проверьте их вывод, используя Shift+Up/Down в режиме in-process или щелкнув панель в режиме split, затем либо:

* Дайте им дополнительные инструкции напрямую
* Порождите товарища по команде для замены, чтобы продолжить работу

### Лидер завершает работу до завершения работы

Лидер может решить, что команда закончена, прежде чем все задачи действительно завершены. Если это произойдет, скажите ему продолжать. Вы также можете сказать лидеру ждать завершения товарищей по команде перед тем, как продолжить, если он начинает делать работу вместо делегирования.

### Осиротевшие сеансы tmux

Если сеанс tmux сохраняется после завершения команды, он может быть не полностью очищен. Перечислите сеансы и завершите тот, который создан командой:

```bash  theme={null}
tmux ls
tmux kill-session -t <session-name>
```

## Ограничения

Команды агентов являются экспериментальными. Текущие ограничения, о которых следует знать:

* **Нет возобновления сеанса с товарищами по команде in-process**: `/resume` и `/rewind` не восстанавливают товарищей по команде in-process. После возобновления сеанса лидер может попытаться отправить сообщение товарищам по команде, которые больше не существуют. Если это произойдет, скажите лидеру порождать новых товарищей по команде.
* **Статус задачи может отставать**: товарищи по команде иногда не отмечают задачи как завершенные, что блокирует зависимые задачи. Если задача кажется застрявшей, проверьте, действительно ли работа выполнена, и обновите статус задачи вручную или скажите лидеру подтолкнуть товарища по команде.
* **Завершение может быть медленным**: товарищи по команде завершают свой текущий запрос или вызов инструмента перед завершением, что может занять время.
* **Одна команда на сеанс**: лидер может управлять только одной командой за раз. Очистите текущую команду перед запуском новой.
* **Нет вложенных команд**: товарищи по команде не могут порождать свои собственные команды или товарищей по команде. Только лидер может управлять командой.
* **Лидер фиксирован**: сеанс, который создает команду, является лидером на всю жизнь. Вы не можете повысить товарища по команде до лидера или передать лидерство.
* **Разрешения установлены при порождении**: все товарищи по команде начинают с режима разрешений лидера. Вы можете изменить режимы отдельных товарищей по команде после порождения, но вы не можете установить режимы для отдельных товарищей по команде во время порождения.
* **Разделенные панели требуют tmux или iTerm2**: режим in-process по умолчанию работает в любом терминале. Режим разделенных панелей не поддерживается в интегрированном терминале VS Code, Windows Terminal или Ghostty.

<Tip>
  **`CLAUDE.md` работает нормально**: товарищи по команде читают файлы `CLAUDE.md` из своего рабочего каталога. Используйте это для предоставления руководства, специфичного для проекта, всем товарищам по команде.
</Tip>

## Следующие шаги

Изучите связанные подходы для параллельной работы и делегирования:

* **Легкое делегирование**: [subagents](/ru/sub-agents) порождают вспомогательных агентов для исследования или проверки в вашем сеансе, лучше для задач, которые не требуют координации между агентами
* **Ручные параллельные сеансы**: [Git worktrees](/ru/common-workflows#run-parallel-claude-code-sessions-with-git-worktrees) позволяют вам запускать несколько сеансов Claude Code самостоятельно без автоматической координации команды
* **Сравнение подходов**: см. сравнение [subagent vs agent team](/ru/features-overview#compare-similar-features) для разбора рядом
